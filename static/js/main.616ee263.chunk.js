(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{134:function(e,t,n){e.exports=n(263)},139:function(e,t,n){},143:function(e,t,n){},263:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(33),o=n.n(i),c=(n(139),n(13)),s=n(14),l=n(16),u=n(15),f=n(17),p=n(114),h=n.n(p),d=(n(141),n(272)),m=n(271),v=(n(143),n(269));function y(e){return b(e.getMonth()+1)+"/"+b(e.getDate())+" "+(b(e.getHours())+":"+b(e.getMinutes()))}function b(e){return("0"+e).slice(-2)}var j=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"info-general"},r.a.createElement(m.a,{as:"h3"},"\u5168\u822c"),r.a.createElement(v.a,{inverted:!0,relaxed:!0},this.renderInfo()))}},{key:"renderInfo",value:function(){var e=this.props.info[0],t=new Date(e.datetime);if(Date.now()-t<=3600*this.props.period*1e3){var n=e.title,a=y(t)+" \u7b2c"+parseInt(e.id.slice(-3))+"\u53f7";return r.a.createElement(v.a.Item,{onClick:this.props.onClick},r.a.createElement(v.a.Content,null,r.a.createElement(v.a.Header,null,n),r.a.createElement(v.a.Description,null,a),r.a.createElement("p",{className:"info-list-headline"},e.headline)))}return null}}]),t}(a.Component),g=n(270),O=n(113),k=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=Object.keys(this.props.regions).sort(),n=Date.now(),a=t.map(function(t){var a=e.props.regions[t][0],r=new Date(a.datetime);if(n-r<=3600*e.props.period*1e3)return a.code=t,a}).filter(function(e){return e});return r.a.createElement("div",null,r.a.createElement(m.a,{as:"h3"},"\u5730\u65b9"),r.a.createElement(w,{info:a,onClick:this.props.onClick}))}}]),t}(a.Component),w=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={activeIndex:null},n.handleClick=function(e,t){var a=t.index,r=n.state.activeIndex===a?-1:a;n.setState({activeIndex:r})},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(g.a,{inverted:!0},this.props.info.map(function(t,n){return e.renderInfo(t,n)}))}},{key:"renderInfo",value:function(e,t){var n=this,a=this.state.activeIndex,i=y(new Date(e.datetime))+" \u7b2c"+parseInt(e.id.slice(-3))+"\u53f7";return r.a.createElement("div",{key:t,className:"accordion-item"},r.a.createElement(g.a.Title,{active:a===t,index:t,onClick:this.handleClick},r.a.createElement(O.a,{name:"dropdown"}),r.a.createElement("span",{className:"info-title"},e.title),r.a.createElement("p",{className:"info-time"},i)),r.a.createElement(g.a.Content,{active:a===t,onClick:function(){return n.props.onClick(e.code)}},r.a.createElement("p",{className:"info-region-headline"},e.headline)))}}]),t}(a.Component),E=n(267),C=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={detail:null},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.fetch()}},{key:"componentDidUpdate",value:function(e){this.props.show&&!e.show&&this.fetch()}},{key:"fetch",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this;this.props.show&&fetch("https://storage.googleapis.com/weather-info/d/"+this.props.id+".json").then(function(e){return e.json()}).then(function(t){console.log(t),e.setState({detail:t})})})},{key:"render",value:function(){return this.state.detail?r.a.createElement("div",{className:"info-detail"},this.state.detail.comment):null}}]),t}(a.Component),I=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={activeIndex:0},n.handleClick=function(e,t){var a=t.index,r=n.state.activeIndex===a?-1:a;n.setState({activeIndex:r})},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(g.a,{inverted:!0},this.props.info.map(function(t,n){return e.renderInfo(t,n)}))}},{key:"renderInfo",value:function(e,t){var n=this.state.activeIndex,a=e.title.split("\u306b\u95a2\u3059\u308b")[0],i=y(new Date(e.datetime))+" \u7b2c"+parseInt(e.id.slice(-3))+"\u53f7";return r.a.createElement("div",{key:t,className:"accordion-item"},r.a.createElement(g.a.Title,{active:n===t,index:t,onClick:this.handleClick},r.a.createElement(O.a,{name:"dropdown"}),r.a.createElement("span",{className:"info-title"},a),r.a.createElement("p",{className:"info-time"},i),r.a.createElement("p",null,e.headline)),r.a.createElement(g.a.Content,{active:n===t},r.a.createElement(E.a,null),r.a.createElement(C,{key:e.id,id:e.id,show:n===t}),r.a.createElement(E.a,null)))}}]),t}(a.Component),x=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"info-pref"},r.a.createElement(m.a,{as:"h3"},"\u5168\u822c\u6c17\u8c61\u60c5\u5831"),r.a.createElement(I,{info:this.props.info}))}}]),t}(a.Component),S=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.info[0].title.split("\u306b\u95a2\u3059\u308b")[1];return r.a.createElement("div",{className:"info-pref"},r.a.createElement(m.a,{as:"h3"},e),r.a.createElement(I,{info:this.props.info,key:e}))}}]),t}(a.Component),N=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.info[0].title.split("\u306b\u95a2\u3059\u308b")[1];return r.a.createElement("div",{className:"info-pref"},r.a.createElement(m.a,{as:"h3"},e),r.a.createElement(I,{info:this.props.info,key:e}))}}]),t}(a.Component),D=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={show:null},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement(d.a,{animation:"overlay",direction:"right",className:"sidebar-dark",inverted:"true",vertical:"true",visible:!0},this.state.show?this.renderShow():this.renderIndex())}},{key:"renderIndex",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(m.a,{as:"h2"},"\u6c17\u8c61\u60c5\u5831"),this.props.data?r.a.createElement(r.a.Fragment,null,r.a.createElement(j,{info:this.props.data.general,period:this.props.period,onClick:function(){return e.setState({show:{type:"general"}})}}),r.a.createElement(k,{regions:this.props.data.regions,period:this.props.period,onClick:function(t){return e.setState({show:{type:"region",code:t}})}})):null)}},{key:"showPref",value:function(e){this.setState({show:{type:"pref",code:e}})}},{key:"renderShow",value:function(){var e=this.state.show;return console.log(e),"general"===e.type?this.renderGeneral():"region"===e.type?this.renderRegion(e.code):"pref"===e.type?this.renderPref(e.code):void 0}},{key:"renderGeneral",value:function(){if(this.props.data&&this.props.data.general)return r.a.createElement(x,{info:this.props.data.general})}},{key:"renderRegion",value:function(e){if(this.props.data&&this.props.data.regions[e])return r.a.createElement(S,{info:this.props.data.regions[e]})}},{key:"renderPref",value:function(e){if(this.props.data&&this.props.data.prefs[e])return r.a.createElement(N,{info:this.props.data.prefs[e]})}}]),t}(a.Component),A=n(124);function M(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r,i=!0,o=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return i=e.done,e},e:function(e){o=!0,r=e},f:function(){try{i||null==a.return||a.return()}finally{if(o)throw r}}}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var G=function(){function e(t,n,a,r){var i=this;Object(c.a)(this,e),this.map=t,this.weatherInfo=n,this.period=a,this.onSelected=r,this.map.addSource("pref-vt",{type:"vector",minzoom:0,maxzoom:10,tiles:["https://weatherbox.github.io/warning-area-vt/pref/{z}/{x}/{y}.pbf"]}),this.map.addLayer({id:"pref-line",type:"line",source:"pref-vt","source-layer":"prefallgeojson",paint:{"line-color":"rgba(55, 55, 55, 0.4)"}}),this.renderWeatherInfoPrefs(),this.map.addLayer({id:"pref-line-selected",type:"line",source:"pref-vt","source-layer":"prefallgeojson",paint:{"line-color":"rgba(70, 171, 199, 0.4)","line-width":2},filter:["==","prefCode","0"]}),this.map.on("click","weather-info-pref",function(e){i.onClick(e)})}return Object(s.a)(e,[{key:"renderWeatherInfoPrefs",value:function(){var e=Date.now(),t=[];for(var n in this.weatherInfo.prefs){var a=this.weatherInfo.prefs[n];if(e-new Date(a[0].datetime)<=3600*this.period*1e3)if(n in L){var r,i=M(L[n]);try{for(i.s();!(r=i.n()).done;){var o=r.value;t.push([o,this.getColor(a.length)])}}catch(c){i.e(c)}finally{i.f()}}else t.push([n,this.getColor(a.length)])}this.map.addLayer({id:"weather-info-pref",type:"fill",source:"pref-vt","source-layer":"prefallgeojson",paint:{"fill-color":{property:"prefCode",type:"categorical",stops:t,default:"rgba(0, 0, 0, 0)"}}})}},{key:"getColor",value:function(e){var t=Math.min(.2+.1*e,.8);return"rgba(0, 49, 73, ".concat(t,")")}},{key:"onClick",value:function(e){if(e.features){console.log(e.features[0].properties);var t=this.getCode(e.features[0].properties.prefCode);this.select(t),this.onSelected(t)}}},{key:"getCode",value:function(e){if("01"!==e.substr(0,2))return e;for(var t in L)if(L[t].includes(e))return t}},{key:"select",value:function(e){var t=[e];e in L&&(t=L[e]),this.map.setFilter("pref-line-selected",["in","prefCode"].concat(Object(A.a)(t)))}}]),e}(),L={"011000":["011000"],"012000":["012010","012020"],"013000":["013000"],"014100":["014020","014010"],"014030":["014030"],"015000":["015010","015020"],"016000":["016010","016020","016030"],"017000":["017010","017020"]},P=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={info:null},n.onSelected=function(e){console.log(n.weatherInfo.prefs[e]),n.weatherInfo.prefs[e]&&n.sidebar.showPref(e)},n}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.loadWeatherInfo()}},{key:"onload",value:function(e){this.map=e,this.addLayer()}},{key:"loadWeatherInfo",value:function(){var e=this,t=(new Date).getTime();fetch("https://storage.googleapis.com/weather-info/weather-info-all.json?"+t,{mode:"cors"}).then(function(e){return e.json()}).then(function(t){console.log(t),e.setState({info:t}),e.weatherInfo=t,e.addLayer()})}},{key:"addLayer",value:function(){this.map&&this.weatherInfo&&(this.layer=new G(this.map,this.weatherInfo,this.props.period,this.onSelected))}},{key:"render",value:function(){var e=this;return r.a.createElement(D,{data:this.state.info,period:this.props.period,ref:function(t){return e.sidebar=t}})}}]),t}(a.Component);h.a.accessToken="pk.eyJ1IjoidGF0dGlpIiwiYSI6ImNqZWZ4eWM3NTI2cGszM2xpYXEyZndpd3IifQ.ifzbR45HecVGxChbdR2hiw";var T=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.map=new h.a.Map({container:this.mapContainer,style:"mapbox://styles/tattii/cj1bob6hw003t2rr5s2svi3iq",zoom:5,center:[136.6,35.5],hash:!0,attributionControl:!1}),this.map.on("load",function(){e.child.onload(e.map)})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"app"},r.a.createElement("div",{ref:function(t){return e.mapContainer=t},id:"map"}),r.a.createElement(P,{ref:function(t){return e.child=t},period:2400}))}}]),t}(a.Component),W=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement(T,null)}}]),t}(a.Component);o.a.render(r.a.createElement(W,null),document.getElementById("app"))}},[[134,2,1]]]);
//# sourceMappingURL=main.616ee263.chunk.js.map