(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{134:function(e,t,n){e.exports=n(263)},139:function(e,t,n){},143:function(e,t,n){},263:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(33),o=n.n(i),c=(n(139),n(13)),l=n(14),s=n(16),u=n(15),p=n(17),f=n(114),h=n.n(f),d=(n(141),n(272)),m=n(271),v=(n(143),n(269));function y(e){return b(e.getMonth()+1)+"/"+b(e.getDate())+" "+(b(e.getHours())+":"+b(e.getMinutes()))}function b(e){return("0"+e).slice(-2)}var g=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"info-general"},a.a.createElement(m.a,{as:"h3"},"\u5168\u822c"),a.a.createElement(v.a,{inverted:!0,relaxed:!0},this.renderInfo()))}},{key:"renderInfo",value:function(){var e=this.props.info[0];if(e&&Date.now()-new Date(e.datetime)<=3600*this.props.period*1e3){var t=e.title,n=y(new Date(e.datetime))+" \u7b2c"+parseInt(e.id.slice(-3))+"\u53f7";return a.a.createElement(v.a.Item,{onClick:this.props.onClick},a.a.createElement(v.a.Content,null,a.a.createElement(v.a.Header,{className:"general-index-title"},t),a.a.createElement(v.a.Description,null,n),a.a.createElement("p",{className:"info-list-headline"},e.headline)))}return this.renderNone()}},{key:"renderNone",value:function(){return a.a.createElement("p",null,"\u904e\u53bb",this.props.period,"\u6642\u9593\u306b\u767a\u8868\u3055\u308c\u305f\u60c5\u5831\u306f\u3042\u308a\u307e\u305b\u3093")}}]),t}(r.Component),j=n(270),k=n(113),w=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=Object.keys(this.props.regions).sort(),n=Date.now(),r=t.map(function(t){var r=e.props.regions[t][0],a=new Date(r.datetime);if(n-a<=3600*e.props.period*1e3)return r.code=t,r}).filter(function(e){return e});return a.a.createElement("div",null,a.a.createElement(m.a,{as:"h3"},"\u5730\u65b9"),r.length>0?a.a.createElement(O,{info:r,onClick:this.props.onClick}):this.renderNone())}},{key:"renderNone",value:function(){return a.a.createElement("p",null,"\u904e\u53bb",this.props.period,"\u6642\u9593\u306b\u767a\u8868\u3055\u308c\u305f\u60c5\u5831\u306f\u3042\u308a\u307e\u305b\u3093")}}]),t}(r.Component),O=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={activeIndex:null},n.handleClick=function(e,t){var r=t.index,a=n.state.activeIndex===r?-1:r;n.setState({activeIndex:a})},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement(j.a,{inverted:!0},this.props.info.map(function(t,n){return e.renderInfo(t,n)}))}},{key:"renderInfo",value:function(e,t){var n=this,r=this.state.activeIndex,i=y(new Date(e.datetime))+" \u7b2c"+parseInt(e.id.slice(-3))+"\u53f7";return a.a.createElement("div",{key:t,className:"accordion-item"},a.a.createElement(j.a.Title,{active:r===t,index:t,onClick:this.handleClick},a.a.createElement(k.a,{name:"dropdown"}),a.a.createElement("span",{className:"info-title"},e.title),a.a.createElement("p",{className:"info-time"},i)),a.a.createElement(j.a.Content,{active:r===t,onClick:function(){return n.props.onClick(e.code)}},a.a.createElement("p",{className:"info-region-headline"},e.headline)))}}]),t}(r.Component),E=n(267),C=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={detail:null},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.fetch()}},{key:"componentDidUpdate",value:function(e){this.props.show&&!e.show&&this.fetch()}},{key:"fetch",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this;this.props.show&&fetch("https://storage.googleapis.com/weather-info/d/"+this.props.id+".json").then(function(e){return e.json()}).then(function(t){console.log(t),e.setState({detail:t})})})},{key:"render",value:function(){return this.state.detail?a.a.createElement("div",{className:"info-detail"},this.state.detail.comment.replace(/[\uff10-\uff19]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}).replace(/\uff0e/g,".")):null}}]),t}(r.Component),I=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={activeIndex:0},n.handleClick=function(e,t){var r=t.index,a=n.state.activeIndex===r?-1:r;n.setState({activeIndex:a})},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement(j.a,{inverted:!0},this.props.info.map(function(t,n){return e.renderInfo(t,n)}))}},{key:"renderInfo",value:function(e,t){var n=this.state.activeIndex,r=e.title.split("\u306b\u95a2\u3059\u308b")[0],i=y(new Date(e.datetime))+" \u7b2c"+parseInt(e.id.slice(-3))+"\u53f7";return a.a.createElement("div",{key:t,className:"accordion-item"},a.a.createElement(j.a.Title,{active:n===t,index:t,onClick:this.handleClick},a.a.createElement(k.a,{name:"dropdown"}),a.a.createElement("span",{className:"info-title"},r," ",e.pdf?a.a.createElement(k.a,{name:"file pdf outline",size:"tiny"}):null),a.a.createElement("p",{className:"info-time"},i),a.a.createElement("p",null,e.headline)),a.a.createElement(j.a.Content,{active:n===t},this.renderDetail(e,n===t)))}},{key:"renderDetail",value:function(e,t){if(e.pdf){var n="https://storage.googleapis.com/weather-info/pdf/"+e.pdf;return a.a.createElement("div",null,a.a.createElement("embed",{src:n,type:"application/pdf",width:"100%",height:"400px"}),a.a.createElement("a",{href:n,target:"_blank",rel:"noopener"},"\u56f3\u5f62\u5f0f"))}return a.a.createElement(a.a.Fragment,null,a.a.createElement(E.a,null),a.a.createElement(C,{key:e.id,id:e.id,show:t}),a.a.createElement(E.a,null))}}]),t}(r.Component),x=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"info-pref"},a.a.createElement(m.a,{as:"h3"},"\u5168\u822c\u6c17\u8c61\u60c5\u5831"),a.a.createElement(I,{info:this.props.info}))}}]),t}(r.Component),S=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.info[0].title.split("\u306b\u95a2\u3059\u308b")[1];return a.a.createElement("div",{className:"info-pref"},a.a.createElement(m.a,{as:"h3"},e),a.a.createElement(I,{info:this.props.info,key:e}))}}]),t}(r.Component),N=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.info[0].title.split("\u306b\u95a2\u3059\u308b")[1];return a.a.createElement("div",{className:"info-pref"},a.a.createElement(m.a,{as:"h3"},e),a.a.createElement(I,{info:this.props.info,key:e}))}}]),t}(r.Component),D=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={show:null},n.selectRegion=function(e){n.setState({show:{type:"region",code:e}}),n.props.onSelectRegion(e)},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return a.a.createElement(d.a,{animation:"overlay",direction:"right",className:"sidebar-dark",inverted:"true",vertical:"true",visible:!0},this.state.show?this.renderShow():this.renderIndex())}},{key:"renderIndex",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(m.a,{as:"h2"},"\u6c17\u8c61\u60c5\u5831"),this.props.data?a.a.createElement(a.a.Fragment,null,a.a.createElement(g,{info:this.props.data.general,period:this.props.period,onClick:function(){return e.setState({show:{type:"general"}})}}),a.a.createElement(w,{regions:this.props.data.regions,period:this.props.period,onClick:this.selectRegion})):null)}},{key:"showPref",value:function(e){this.setState({show:{type:"pref",code:e}})}},{key:"renderShow",value:function(){var e=this.state.show;return console.log(e),"general"===e.type?this.renderGeneral():"region"===e.type?this.renderRegion(e.code):"pref"===e.type?this.renderPref(e.code):void 0}},{key:"renderGeneral",value:function(){if(this.props.data&&this.props.data.general)return a.a.createElement(x,{info:this.props.data.general})}},{key:"renderRegion",value:function(e){if(this.props.data&&this.props.data.regions[e])return a.a.createElement(S,{info:this.props.data.regions[e]})}},{key:"renderPref",value:function(e){if(this.props.data&&this.props.data.prefs[e])return a.a.createElement(N,{info:this.props.data.prefs[e]})}}]),t}(r.Component),A=n(124);function R(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a,i=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw a}}}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var M=function(){function e(t,n,r,a){var i=this;Object(c.a)(this,e),this.map=t,this.weatherInfo=n,this.period=r,this.onSelected=a,this.map.addSource("pref-vt",{type:"vector",minzoom:0,maxzoom:10,tiles:["https://weatherbox.github.io/warning-area-vt/pref/{z}/{x}/{y}.pbf"]}),this.map.addLayer({id:"pref-line",type:"line",source:"pref-vt","source-layer":"prefallgeojson",paint:{"line-color":"rgba(55, 55, 55, 0.4)"}}),this.renderWeatherInfoPrefs(),this.map.addLayer({id:"pref-line-selected",type:"line",source:"pref-vt","source-layer":"prefallgeojson",paint:{"line-color":"rgba(70, 171, 199, 0.4)","line-width":2},filter:["==","prefCode","0"]}),this.addRegion(),this.map.on("click","weather-info-pref",function(e){i.onClick(e)})}return Object(l.a)(e,[{key:"addRegion",value:function(){this.map.addSource("region-vt",{type:"vector",minzoom:0,maxzoom:8,tiles:["https://weatherbox.github.io/warning-area-vt/region/{z}/{x}/{y}.pbf"]}),this.map.addLayer({id:"region-line-selected",type:"line",source:"region-vt","source-layer":"region",paint:{"line-color":"rgba(70, 171, 199, 0.4)","line-width":1},filter:["==","code","0"]})}},{key:"renderWeatherInfoPrefs",value:function(){var e=Date.now(),t=[];for(var n in this.weatherInfo.prefs){var r=this.weatherInfo.prefs[n];if(e-new Date(r[0].datetime)<=3600*this.period*1e3)if(n in F){var a,i=R(F[n]);try{for(i.s();!(a=i.n()).done;){var o=a.value;t.push([o,this.getColor(r.length)])}}catch(c){i.e(c)}finally{i.f()}}else t.push([n,this.getColor(r.length)])}this.map.addLayer({id:"weather-info-pref",type:"fill",source:"pref-vt","source-layer":"prefallgeojson",paint:{"fill-color":{property:"prefCode",type:"categorical",stops:t,default:"rgba(0, 0, 0, 0)"}}})}},{key:"getColor",value:function(e){var t=Math.min(.2+.1*e,.8);return"rgba(0, 49, 73, ".concat(t,")")}},{key:"onClick",value:function(e){if(e.features){console.log(e.features[0].properties);var t=this.getCode(e.features[0].properties.prefCode);this.select(t),this.onSelected(t)}}},{key:"getCode",value:function(e){if("01"!==e.substr(0,2))return e;for(var t in F)if(F[t].includes(e))return t}},{key:"select",value:function(e){var t=[e];e in F&&(t=F[e]),this.map.setFilter("pref-line-selected",["in","prefCode"].concat(Object(A.a)(t))),this.map.setFilter("region-line-selected",["==","code","0"])}},{key:"selectRegion",value:function(e){this.map.setFilter("pref-line-selected",["==","prefCode","0"]),this.map.setFilter("region-line-selected",["==","code",e])}}]),e}(),F={"011000":["011000"],"012000":["012010","012020"],"013000":["013000"],"014100":["014020","014010"],"014030":["014030"],"015000":["015010","015020"],"016000":["016010","016020","016030"],"017000":["017010","017020"]},L=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={info:null},n.onSelected=function(e){console.log(n.weatherInfo.prefs[e]),n.weatherInfo.prefs[e]&&n.sidebar.showPref(e)},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.loadWeatherInfo()}},{key:"onload",value:function(e){this.map=e,this.addLayer()}},{key:"loadWeatherInfo",value:function(){var e=this,t=(new Date).getTime();fetch("https://storage.googleapis.com/weather-info/weather-info-all.json?"+t,{mode:"cors"}).then(function(e){return e.json()}).then(function(t){console.log(t),e.setState({info:t}),e.weatherInfo=t,e.addLayer()})}},{key:"addLayer",value:function(){this.map&&this.weatherInfo&&(this.layer=new M(this.map,this.weatherInfo,this.props.period,this.onSelected))}},{key:"render",value:function(){var e=this;return a.a.createElement(D,{data:this.state.info,period:this.props.period,ref:function(t){return e.sidebar=t},onSelectRegion:function(t){return e.layer.selectRegion(t)}})}}]),t}(r.Component);h.a.accessToken="pk.eyJ1IjoidGF0dGlpIiwiYSI6ImNqZWZ4eWM3NTI2cGszM2xpYXEyZndpd3IifQ.ifzbR45HecVGxChbdR2hiw";var G=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.map=new h.a.Map({container:this.mapContainer,style:"mapbox://styles/tattii/cj1bob6hw003t2rr5s2svi3iq",zoom:5,center:[136.6,35.5],hash:!0,attributionControl:!1}),this.map.on("load",function(){e.child.onload(e.map)})}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"app"},a.a.createElement("div",{ref:function(t){return e.mapContainer=t},id:"map"}),a.a.createElement(L,{ref:function(t){return e.child=t},period:48}))}}]),t}(r.Component),P=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return a.a.createElement(G,null)}}]),t}(r.Component);o.a.render(a.a.createElement(P,null),document.getElementById("app"))}},[[134,2,1]]]);
//# sourceMappingURL=main.1fee66ee.chunk.js.map